---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Card } from "../../components/ui/card";
import { Separator } from "../../components/ui/separator";
import { Book, ChevronRight, Home } from "lucide-react";

const allDocs = await getCollection("docs");

// Group docs by category
const docsByCategory = allDocs.reduce(
  (acc, doc) => {
    const category = doc.data.category || "guides";
    if (!acc[category]) acc[category] = [];
    acc[category].push(doc);
    return acc;
  },
  {} as Record<string, typeof allDocs>
);

// Sort docs within each category by order
Object.keys(docsByCategory).forEach((category) => {
  docsByCategory[category].sort((a, b) => {
    const orderA = a.data.order ?? 999;
    const orderB = b.data.order ?? 999;
    return orderA - orderB;
  });
});

const categoryLabels: Record<string, string> = {
  settings: "Settings",
  setup: "Setup Guides",
  guides: "User Guides",
  general: "General",
};

// Define the order categories should appear in
const categoryOrder = ["settings", "setup", "guides", "general"];
---

<Layout
  title="Documentation - Summit AI Notes"
  description="Learn how to use Summit AI Notes for meeting transcription and summarization"
>
  <div class="min-h-screen bg-gradient-to-br from-background via-background to-muted/20">
    <div class="container mx-auto px-4 py-8">
      <div class="max-w-7xl mx-auto">
        <!-- Breadcrumb -->
        <div class="flex items-center gap-2 text-sm text-muted-foreground mb-6">
          <a href="/" class="hover:text-foreground transition-colors flex items-center gap-1">
            <Home class="w-4 h-4" />
            Home
          </a>
          <ChevronRight class="w-4 h-4" />
          <span class="text-foreground font-medium">Documentation</span>
        </div>

        <div class="grid lg:grid-cols-[280px_1fr] gap-8">
          <!-- Sidebar Navigation -->
          <aside class="lg:sticky lg:top-8 lg:self-start">
            <Card className="p-6">
              <div class="flex items-center gap-2 mb-6">
                <Book class="w-5 h-5 text-blue-600" />
                <h2 class="text-lg font-semibold text-foreground">Documentation</h2>
              </div>

              <nav class="space-y-6">
                {categoryOrder
                  .filter((category) => docsByCategory[category])
                  .map((category) => {
                    const docs = docsByCategory[category];
                    return (
                      <div>
                        <h3 class="text-sm font-semibold text-foreground mb-2 uppercase tracking-wide">
                          {categoryLabels[category] || category}
                        </h3>
                        <ul class="space-y-1">
                          {docs.map((navDoc) => (
                            <li>
                              <a
                                href={`/docs/${navDoc.slug}`}
                                class="block px-3 py-2 rounded-md text-sm transition-colors text-muted-foreground hover:text-foreground hover:bg-muted/50"
                              >
                                {navDoc.data.title}
                              </a>
                            </li>
                          ))}
                        </ul>
                      </div>
                    );
                  })}
              </nav>
            </Card>
          </aside>

          <!-- Main Content -->
          <main>
            <Card className="p-8 lg:p-12">
              <!-- Page Header -->
              <header class="mb-8">
                <h1 class="text-4xl font-bold text-foreground mb-4">Documentation</h1>
                <p class="text-xl text-muted-foreground">
                  Everything you need to know about using Summit AI Notes for meeting transcription, summarization, and documentation.
                </p>
              </header>

              <Separator className="mb-8" />

              <!-- Content -->
              <article class="prose prose-slate max-w-none
                prose-headings:text-foreground prose-headings:font-bold
                prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4
                prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3
                prose-p:text-muted-foreground prose-p:leading-relaxed
                prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
                prose-strong:text-foreground prose-strong:font-semibold
                prose-ul:text-muted-foreground prose-ul:my-4
                prose-li:my-1
              ">
                <h2>Getting Started</h2>
                <p>
                  New to Summit AI Notes? The first step is choosing how you want to generate AI summaries. You have three options:
                </p>
                <ul>
                  <li><strong>Local AI</strong> — Run AI directly on your Mac. Complete privacy, works offline, zero ongoing costs.</li>
                  <li><strong>Cloud AI</strong> — Connect to OpenAI, Anthropic, or Google Gemini for fast, high-quality summaries.</li>
                  <li><strong>Self-Hosted</strong> — Run your own AI server with LM Studio or Ollama for full control.</li>
                </ul>
                <p>
                  <a href="/docs/settings/llm">Read the AI Provider Guide →</a>
                </p>

                <h2>Setup Guides</h2>
                <p>
                  Step-by-step instructions to get Summit AI Notes configured for your workflow:
                </p>
                <ul>
                  <li><a href="/docs/setup/local-ai">Local AI Setup</a> — Download and configure built-in AI models</li>
                  <li><a href="/docs/setup/cloud-providers">Cloud AI Setup</a> — Connect to OpenAI, Anthropic, or Google Gemini</li>
                  <li><a href="/docs/setup/lmstudio">LM Studio Setup</a> — Run your own AI server for complete control</li>
                </ul>

                <h2>Customization</h2>
                <p>
                  Tailor Summit AI Notes to your specific needs:
                </p>
                <ul>
                  <li><a href="/docs/guides/summary-templates">Summary Templates</a> — Guide the AI on what to focus on using Attention Templates</li>
                  <li><a href="/docs/general/local-models">Choosing a Local Model</a> — Pick the right model for your Mac's capabilities</li>
                </ul>

                <h2>Need Help?</h2>
                <p>
                  Can't find what you're looking for? Check our <a href="/faq">FAQ</a> for common questions, or <a href="/support">contact support</a> for personalized help.
                </p>
              </article>
            </Card>
          </main>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Dark mode prose overrides */
  :global(.dark) .prose {
    --tw-prose-body: var(--muted-foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-links: rgb(59 130 246);
    --tw-prose-bold: var(--foreground);
  }

  /* Responsive sidebar on mobile */
  @media (max-width: 1023px) {
    aside {
      position: static;
    }
  }
</style>
